<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catálogo — Miyotl Products</title>
  <meta name="description" content="Catálogo de jabones artesanales de glicerina. Filtra por piel sensible, exfoliantes, astringentes o aromáticos.">
  <style>
    :root{
      --brand-50:#F7EFE6; --brand-100:#F2E6D8; --brand-200:#EAD6C0; --brand-300:#DBBFA2;
      --brand-400:#C9A781; --brand-500:#2B0F3A; --brand-700:#1B0D28;
      --miyotl:#C53D8C; --ink:#140A1F;
      --rose:#E067C6; --rose-strong:#A83477; --muted:#8E8E8E;
      --bar:#F2CFE9;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,Segoe UI,Roboto,Arial;color:var(--ink);background:#fff;font-size:13px;line-height:1.35}
    .container{max-width:1120px;margin:0 auto;padding:0 16px}

    header{background:#e1d1bd}
    .top-banner{width:100%;height:260px;object-fit:cover;display:block;filter:saturate(0.9)}
    .headline{position:relative}
    .headline h1{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);margin:0;color:#fff;background:rgba(0,0,0,.35);padding:8px 14px;border-radius:12px;font-weight:900;letter-spacing:.3px}

    .filters-wrap{display:flex;justify-content:center;align-items:center;flex-wrap:wrap;gap:12px;padding:12px 16px;border-bottom:1px solid var(--brand-200);background:#fff}
    .filters button{appearance:none;border:1px solid #A83477;background:var(--miyotl);color:#fff;cursor:pointer;padding:6px 10px;border-radius:12px;font-weight:700;font-size:12px;transition:.15s transform,.15s opacity}
    .filters button:hover{transform:translateY(-1px)}
    .filters button.is-active{box-shadow:0 2px 10px rgba(0,0,0,.12)}
    .note{font-size:11px;color:#4d4d4d;text-align:center;margin:8px 0 18px}

    .grid{display:grid;gap:18px}
    @media(min-width:768px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}

    .card{background:#fff;border:2px solid var(--rose);border-radius:22px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,.06);transition:.15s transform,.15s border-color;cursor:pointer}
    .card:hover{transform:translateY(-3px);border-color:var(--rose-strong)}
    .card .image-wrap{position:relative;border-radius:20px;overflow:hidden;margin:6px;border:2px solid var(--rose)}
    .card .image-wrap img{width:100%;aspect-ratio:1/1;object-fit:cover;display:block;filter:saturate(.98)}
    .card .badge{position:absolute;right:10px;bottom:10px;width:60px;height:60px;border-radius:999px;background:var(--rose);color:#fff;display:flex;align-items:center;justify-content:center;text-align:center;font-weight:800;line-height:1.05;padding:6px;box-shadow:0 6px 18px rgba(0,0,0,.18);font-size:10px}
    .card .row-2{display:grid;grid-template-columns:1fr 2fr;gap:10px;padding:8px 10px 0}
    .pill{background:#fff;border:2px solid var(--rose);border-radius:16px;padding:6px 9px;color:#5A5A5A;font-weight:800;text-align:center;min-height:30px;display:flex;align-items:center;justify-content:center;font-size:11px}

    .bar{background:var(--bar);color:#2b2330;border-radius:4px;text-align:center;font-weight:800;padding:4px 0;font-size:10px;line-height:1.1}
    .val{font-weight:800;text-align:center;color:#4b4b4b;font-size:11px;margin-top:4px}
    .row-3{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;padding:8px 10px 2px}
    .price-col{display:grid}
    .kilo{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;padding:8px 10px 0}
    .kilo .title{grid-column:1/-1}
    .meta3{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;padding:8px 10px 12px}
    .meta3 .col{display:grid}

    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);padding:20px;z-index:1000}
    .modal.open{display:flex}
    #modalProd .sheet{background:transparent;box-shadow:none;padding:0;border-radius:0;position:relative}
    #modalProd .img-max{position:relative;max-width:min(92vw,1000px);width:100%;margin:0 auto;border-radius:18px;overflow:hidden;box-shadow:0 12px 40px rgba(0,0,0,.45);border:2px solid var(--rose);background:#fff}
    #modalProd .img-max img{display:block;width:100%;height:auto}
    #mp-close{position:absolute;top:-12px;right:-12px;z-index:3;background:#fff;color:var(--ink);border:2px solid var(--rose);border-radius:999px;padding:8px 12px;font-weight:900;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.25)}
    .mp-overlay{position:absolute;right:10px;bottom:10px;z-index:2;display:grid;gap:8px;max-width:min(40vw,280px)}
    .overlay-card{position:relative;background:#fff;border:2px solid var(--rose);border-radius:12px;padding:8px 10px 10px;box-shadow:0 6px 18px rgba(0,0,0,.25);max-height:140px;overflow:auto;font-size:12px;color:#4b4b4b}
    .overlay-pill{position:absolute;left:8px;top:-12px;background:#D874C3;color:#fff;border:none;border-radius:14px;padding:4px 10px;font-weight:800;font-size:11px}

    .empty{margin:26px auto;max-width:860px;padding:12px 14px;border:1px dashed #d3a7c7;border-radius:12px;color:#6b3e64;background:#fff9fd;text-align:center;font-weight:700}
    footer{padding:18px 0 28px;border-top:1px solid var(--brand-100);margin-top:28px}
  </style>
</head>
<body>

<header class="headline">
  <img class="top-banner" src="assets/images/catalogo-banner.webp" alt="">
</header>

<div class="filters-wrap">
  <div class="filters">
    <button data-filter="all" class="is-active">Todos</button>
    <button data-filter="sensible">Piel sensible</button>
    <button data-filter="exfoliante">Exfoliantes</button>
    <button data-filter="astringente">Astringentes</button>
    <button data-filter="aromatico">Aromáticos</button>
  </div>
</div>
<p class="note">Haz clic en cualquier producto para ver sus beneficios.</p>

<main class="container">
  <section id="grid" class="grid"></section>
  <div id="empty" class="empty" style="display:none"></div>
</main>

<footer><div class="container" style="text-align:center">© <span id="year"></span> Miyotl Products · Hecho en México</div></footer>

<div id="modalProd" class="modal" role="dialog" aria-modal="true">
  <div class="sheet">
    <button id="mp-close" class="btn secondary">Cerrar</button>
    <div class="img-max">
      <img id="mp-img" alt="">
      <div id="mp-overlay" class="mp-overlay" aria-hidden="true" style="display:none"></div>
    </div>
  </div>
</div>

<script>
const grid=document.getElementById('grid');
const empty=document.getElementById('empty');
const btns=document.querySelectorAll('.filters button[data-filter]');
let PRODUCTS=[];

const money=v=>{if(v===undefined||v===null||v==='')return'';const n=Number(v);return Number.isFinite(n)?n.toLocaleString('es-MX',{style:'currency',currency:'MXN',maximumFractionDigits:0}):(v+'');};

function productCard(p){
  const el=document.createElement('article'); el.className='card'; el.dataset.cats=(p.cats||[]).join(',');
  const pub=money(p.precioPublico), may=money(p.precioMayoreo), dis=money(p.precioDistribuidor);
  const pubK=money(p.precioPublico_K), mayK=money(p.precioMayoreo_K), disK=money(p.precioDistribuidor_K);
  el.innerHTML=`
    <div class="image-wrap">
      <img src="${p.img}" alt="${p.nombre}" loading="lazy"
     data-step="1"
     onerror="
       if (this.dataset.step==='1') { this.dataset.step='2'; this.src='${p.imgBase}.jpg'; }
       else if (this.dataset.step==='2') { this.dataset.step='3'; this.src='${p.imgBase}.png'; }
       else {
         this.onerror=null;
         this.src='data:image/svg+xml;utf8,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 800 800%27><rect width=%27800%27 height=%27800%27 fill=%27%23f2f2f2%27/><text x=%2750%25%27 y=%2750%25%27 dominant-baseline=%27middle%27 text-anchor=%27middle%27 fill=%27%23999%27 font-family=%27Arial%27 font-size=%2750%27>Sin imagen</text></svg>';
       }">

      ${p.etiqueta?`<div class="badge">${p.etiqueta}</div>`:''}
    </div>
    <div class="row-2"><div class="pill">${p.codigo||''}</div><div class="pill">${p.nombre||''}</div></div>
    <div class="row-3">
      <div class="price-col"><div class="bar">Público</div><div class="val">${pub}</div></div>
      <div class="price-col"><div class="bar">Mayoreo</div><div class="val">${may}</div></div>
      <div class="price-col"><div class="bar">Distribuidor</div><div class="val">${dis}</div></div>
    </div>
    <div class="kilo">
      <div class="title"><div class="bar">Por barra de kilo</div></div>
      <div class="val">${pubK}</div><div class="val">${mayK}</div><div class="val">${disK}</div>
    </div>
  `;
  el.onclick=()=>openProduct(p);
  return el;
}

function render(filter='all'){
  grid.innerHTML='';
  const list=PRODUCTS.filter(p=>filter==='all'||(p.cats||[]).includes(filter));
  list.forEach(p=>grid.appendChild(productCard(p)));
  empty.style.display = list.length ? 'none' : 'block';
  if(!list.length){
    empty.innerHTML = 'No hay productos para mostrar. Revisa que <b>catalogo.json</b> exista, tenga formato válido y esté en la misma carpeta que <b>catalogo.html</b>.';
  }
}
btns.forEach(b=>b.onclick=()=>{btns.forEach(x=>x.classList.remove('is-active'));b.classList.add('is-active');render(b.dataset.filter);});

/* ======== Modal ======== */
const modalProd=document.getElementById('modalProd'), mpClose=document.getElementById('mp-close'), mpImg=document.getElementById('mp-img'), mpOverlay=document.getElementById('mp-overlay');
const overlayCard=(t,h)=>`<div class="overlay-card"><span class="overlay-pill">${t}</span><div>${h}</div></div>`;
function openProduct(p){
  const arr=v=>Array.isArray(v)?v:(v?[v]:[]);
  mpImg.src=p.img; mpImg.alt=p.nombre||'';
  let html='';
  if(arr(p.ingredientes).length)html+=overlayCard('Ingredientes',`<ul>${arr(p.ingredientes).slice(0,5).map(x=>`<li>${x}</li>`).join('')}</ul>`);
  if(arr(p.beneficios).length)html+=overlayCard('Beneficios',`<ul>${arr(p.beneficios).slice(0,5).map(x=>`<li>${x}</li>`).join('')}</ul>`);
  if(arr(p.avisos).length)html+=overlayCard('Avisos',`<ul>${arr(p.avisos).slice(0,5).map(x=>`<li>${x}</li>`).join('')}</ul>`);
  mpOverlay.innerHTML=html; mpOverlay.style.display=html?'grid':'none';
  modalProd.classList.add('open');
}
mpClose.onclick=()=>modalProd.classList.remove('open');

/* ======== Carga JSON robusta ======== */
(function(){
  const mapCat=s=>{if(!s)return'';s=(''+s).toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');if(s.includes('sensible'))return'sensible';if(s.includes('exfol'))return'exfoliante';if(s.includes('astring'))return'astringente';if(s.includes('aromatic'))return'aromatico';return s;};
  const toArray=v=>Array.isArray(v)?v.filter(Boolean):(typeof v==='string'?(v.includes('|||')?v.split('|||').map(x=>x.trim()).filter(Boolean):v.includes(',')?v.split(',').map(x=>x.trim()).filter(Boolean):(v.trim()?[v.trim()]:[])):[]);
  const toSlug = s => (s||'').toString().toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
    .replace(/[^a-z0-9]+/g,'_').replace(/^_|_$/g,'');

  // NUEVO: devolvemos la BASE sin extensión para poder probar .webp, .jpg, .png
  const pickImgBase = (row) => {
    const v = (row.img || '').trim();
    if (!v) {
      const slug = toSlug(row.nombre || '');
      return slug ? `assets/images/${slug}` : `assets/images/placeholder`;
    }
    if (/^https?:\/\//i.test(v)) return v; // url absoluta
    if (/\.(png|jpe?g|webp|gif|avif|svg)$/i.test(v)) {
      return `assets/images/${v.replace(/\.(png|jpe?g|webp|gif|avif|svg)$/i,'')}`;
    }
    return `assets/images/${v}`;
  };

    if(/^https?:\/\//i.test(v))return v; if(/\.(png|jpe?g|webp|gif|avif|svg)$/i.test(v))return`assets/images/${v}`; return`assets/images/${v}.webp`;};

  async function loadJSON(){
    const tries=['./catalogo.json','catalogo.json','/Miyotl/catalogo.json','./Catalogo.json'];
    for(const url of tries){
      try{
        const r=await fetch(url+'?v='+Date.now(),{cache:'no-store'});
        if(!r.ok) continue;
        const txt=await r.text();
        const data=JSON.parse(txt);
        console.log('[catalogo] OK con', url);
        return data;
      }catch(e){
        console.warn('[catalogo] fallo', e);
      }
    }
    throw new Error('No se pudo cargar catalogo.json desde ninguna ruta conocida.');
  }

  loadJSON()
    .then(data=>{
      PRODUCTS = data.map(row=>{
        const cats=toArray(row.cats).map(mapCat).filter(Boolean);
        return {
          id: row.id || '',
          codigo: row.codigo ?? '',
          nombre: row.nombre || 'Producto',
                    imgBase: pickImgBase(row),
          img: (/^https?:\/\//i.test(pickImgBase(row)) ? pickImgBase(row) : pickImgBase(row) + '.webp'),

          cats,
          beneficios: toArray(row.beneficios),
          avisos: toArray(row.avisos || row.notaAdvertencia),
          ingredientes: toArray(row.ingredientes),
          etiqueta: row.etiqueta ?? '',
          precioPublico: row.precioPublico ?? '',
          precioMayoreo: row.precioMayoreo ?? '',
          precioDistribuidor: row.precioDistribuidor ?? '',
          precioPublico_K: row.precioPublico_K ?? '',
          precioMayoreo_K: row.precioMayoreo_K ?? '',
          precioDistribuidor_K: row.precioDistribuidor_K ?? '',
          categoria: row.categoria ?? row.categirua ?? '',
          contenido: row.contenido ?? ''
        };
      });
      render('all');
    })
    .catch(err=>{
      console.error(err);
      empty.style.display='block';
      empty.innerHTML='⚠️ No se pudo cargar <b>catalogo.json</b>. Verifica que el archivo exista en la misma carpeta y que el nombre (may/minúsculas) coincida exactamente.';
    });
})();
document.getElementById('year').textContent=new Date().getFullYear();
</script>
</body>
</html>


