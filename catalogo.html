<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Catálogo — Miyotl Products</title>
<meta name="description" content="Catálogo de jabones artesanales de glicerina. Filtra por piel sensible, exfoliantes, astringentes o aromáticos.">
<style>
:root{
  --brand-50:#F7EFE6; --brand-100:#F2E6D8; --brand-200:#EAD6C0; --brand-300:#DBBFA2;
  --brand-400:#C9A781; --brand-500:#2B0F3A; --brand-700:#1B0D28;
  --miyotl:#C53D8C; --ink:#140A1F;
  --rose:#E067C6; --rose-strong:#A83477; --muted:#8E8E8E;
  --bar:#F2CFE9; /* franja rosa clara */
}
*{box-sizing:border-box}
body{margin:0;font-family:ui-sans-serif,system-ui,Inter,Segoe UI,Roboto,Arial;color:var(--ink);background:#fff;font-size:13px;line-height:1.35}
.container{max-width:1120px;margin:0 auto;padding:0 16px}

/* Banner / filtros (igual) */
header{background:#e1d1bd}
.top-banner{width:100%;height:260px;object-fit:cover;display:block;filter:saturate(0.9)}
.headline{position:relative}
.headline h1{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);margin:0;color:#fff;background:rgba(0,0,0,.35);padding:8px 14px;border-radius:12px;font-weight:900;letter-spacing:.3px}
.filters-wrap{display:flex;justify-content:center;align-items:center;flex-wrap:wrap;gap:12px;padding:12px 16px;border-bottom:1px solid var(--brand-200);background:#fff}
.filters{display:flex;gap:10px;flex-wrap:wrap}
.filters button{appearance:none;border:1px solid #A83477;background:var(--miyotl);color:#fff;cursor:pointer;padding:6px 10px;border-radius:12px;font-weight:700;font-size:12px;transition:.15s transform,.15s opacity}
.filters button:hover{transform:translateY(-1px)}
.filters button.is-active{box-shadow:0 2px 10px rgba(0,0,0,.12)}
.note{font-size:11px;color:#4d4d4d;text-align:center;margin:8px 0 18px}

/* Grid: 3 por fila */
.grid{display:grid;gap:18px}
@media(min-width:768px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}

/* Tarjeta */
.card{background:#fff;border:2px solid var(--rose);border-radius:22px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,.06);transition:.15s transform,.15s border-color;cursor:pointer}
.card:hover{transform:translateY(-3px);border-color:var(--rose-strong)}
.card .image-wrap{position:relative;border-radius:20px;overflow:hidden;margin:6px;border:2px solid var(--rose)}
.card .image-wrap img{width:100%;aspect-ratio:1/1;object-fit:cover;display:block;filter:saturate(.98)}
.card .badge{position:absolute;right:10px;bottom:10px;width:60px;height:60px;border-radius:999px;background:var(--rose);color:#fff;display:flex;align-items:center;justify-content:center;text-align:center;font-weight:800;line-height:1.05;padding:6px;box-shadow:0 6px 18px rgba(0,0,0,.18);font-size:10px}

/* Código / Nombre (píldoras conservadas) */
.card .row-2{display:grid;grid-template-columns:1fr 2fr;gap:10px;padding:8px 10px 0}
.pill{background:#fff;border:2px solid var(--rose);border-radius:16px;padding:6px 9px;color:#5A5A5A;font-weight:800;text-align:center;min-height:30px;display:flex;align-items:center;justify-content:center;font-size:12px}

/* ===== Estilo tabla de barras ===== */
.bar{
  background:var(--bar);
  color:#2b2330;
  border-radius:4px;         /* casi recto */
  text-align:center;
  font-weight:800;
  padding:4px 0;             /* franja delgada */
  font-size:11px;            /* chico */
  line-height:1.1;
}
.val{
  font-weight:800;
  text-align:center;
  color:#4b4b4b;
  font-size:12px;
  margin-top:4px;            /* poco espacio */
}

/* precios pieza */
.row-3{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;padding:8px 10px 2px}
.price-col{display:grid}

/* precios por kilo */
.kilo{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;padding:8px 10px 0}
.kilo .title{grid-column:1/-1}
.kilo .title .bar{text-transform:none}

/* cats / categoria / contenido */
.meta3{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;padding:8px 10px 12px}
.meta3 .col{display:grid}

/* Modal (sin cambios sustanciales) */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.38);padding:20px;z-index:1000}
.modal.open{display:flex}
.sheet{background:#fff;max-width:720px;width:min(92vw,720px);border-radius:16px;padding:16px;box-shadow:0 10px 40px rgba(0,0,0,.25)}
.sheet header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;background:none}
.sheet .media{display:grid;gap:12px;grid-template-columns:160px 1fr}
.sheet .media .img-wrap{position:relative}
.sheet .media img{width:100%;border-radius:12px;display:block}
.btn{appearance:none;border:0;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer;color:#fff;background:var(--miyotl)}
.btn.secondary{background:#fff;color:var(--ink);border:1px solid var(--brand-300)}
.muted{color:var(--muted)}
.mp-overlay{position:absolute;right:8px;bottom:8px;display:grid;gap:8px;max-width:min(42vw,260px);z-index:2}
.overlay-card{position:relative;background:#fff;border:2px solid var(--rose);border-radius:16px;padding:10px 12px 12px;box-shadow:0 6px 18px rgba(0,0,0,.18);max-height:140px;overflow:auto;font-size:12px;color:#5A5A5A}
.overlay-pill{position:absolute;left:0;top:-12px;background:#D874C3;color:#fff;border:none;border-radius:16px;padding:6px 12px;font-weight:800;font-size:12px;transform:translateX(8px)}

footer{padding:18px 0 28px;border-top:1px solid var(--brand-100);margin-top:28px}
</style>
</head>
<body>

<header class="headline">
  <img class="top-banner" src="assets/images/catalogo-banner.webp" alt="">
  <nav class="nav-under-banner">
    <a href="index.html">Inicio</a>Es
    <a href="nosotros.html">Nosotros</a>
    <a href="catalogo.html">Catálogo</a>
    <a href="distribuidor.html">Quiero ser distribuidor</a>
    <a href="politicas.html">Políticas</a>
    <a href="aviso.html">Aviso de privacidad</a>
  </nav>
</header>

<div class="filters-wrap">
  <div class="filters">
    <button data-filter="all" class="is-active">Todos</button>
    <button data-filter="sensible">Piel sensible</button>
    <button data-filter="exfoliante">Exfoliantes</button>
    <button data-filter="astringente">Astringentes</button>
    <button data-filter="aromatico">Aromáticos</button>
  </div>
  <div class="filters-home">
    <button id="btn-home" type="button" class="btn secondary" onclick="window.location.href='index.html'">Inicio</button>
  </div>
</div>
<p class="note">Haz clic en cualquier producto para ver sus beneficios. Elije lo que tu piel necesita.</p>

<main class="container">
  <section id="grid" class="grid"></section>
</main>

<footer><div class="container" style="text-align:center">© <span id="year"></span> Miyotl Products · Hecho en México</div></footer>

<!-- Modal Producto -->
<div id="modalProd" class="modal" role="dialog" aria-modal="true">
  <div class="sheet">
    <header><h3 id="mp-title" style="margin:0"></h3><button id="mp-close" class="btn secondary">Cerrar</button></header>
    <div class="media">
      <div class="img-wrap">
        <img id="mp-img" alt="">
        <div id="mp-overlay" class="mp-overlay" aria-hidden="true" style="display:none"></div>
      </div>
      <div>
        <p id="mp-benefits" class="muted" style="margin-top:0"></p>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
          <button id="btn-order" class="btn">Hacer pedido</button>
          <span id="mp-tags" class="muted"></span>
        </div>
        <p class="muted" style="margin-top:12px">*Recuerda probar primero en una zona pequeña si tu piel es muy reactiva.</p>
      </div>
    </div>
  </div>
</div>

<!-- Modal Sign-in -->
<div id="modalAuth" class="modal" role="dialog" aria-modal="true">
  <div class="sheet">
    <header><h3 style="margin:0">Inicia sesión para continuar</h3><button id="ma-close" class="btn secondary">Cerrar</button></header>
    <div class="stack">
      <input id="email" type="email" placeholder="tu@correo.com">
      <input id="pass" type="password" placeholder="••••••••">
      <button id="login" class="btn">Entrar</button>
      <p class="muted center">¿Aún no tienes cuenta? <a href="/registro">Regístrate</a></p>
    </div>
  </div>
</div>

<script>
/* ===== Render grid y filtros ===== */
const grid=document.getElementById('grid');
const btns=document.querySelectorAll('.filters button[data-filter]');
let currentFilter='all';
let PRODUCTS=[];

const money=v=>{ if(v===undefined||v===null||v==='') return ''; const n=Number(v); return Number.isFinite(n)? n.toLocaleString('es-MX',{style:'currency',currency:'MXN',maximumFractionDigits:0}) : (v+''); };
const s=v=>(v??'')+''; // string

function productCard(p){
  const el=document.createElement('article');
  el.className='card';
  el.dataset.cats=(p.cats||[]).join(',');

  const codigo=s(p.codigo);
  const nombre=s(p.nombre);
  const pub=money(p.precioPublico);
  const may=money(p.precioMayoreo);
  const dis=money(p.precioDistribuidor);
  const etiqueta=s(p.etiqueta);
  const catsTxt=Array.isArray(p.cats)? p.cats.join(', ') : s(p.cats);
  const categoria=s(p.categoria || p.categirua);   // soporta 'categirua'
  const contenido=s(p.contenido);
  const pubK=money(p.precioPublico_K);
  const mayK=money(p.precioMayoreo_K);
  const disK=money(p.precioDistribuidor_K);

  el.innerHTML=`
    <div class="image-wrap">
      <img src="${p.img}" alt="${p.nombre}" loading="lazy">
      ${etiqueta?`<div class="badge">${etiqueta.replace(/(.{1,3})/g,'$1<br>').replace(/<br>$/,'')}</div>`:''}
    </div>

    <div class="row-2">
      <div class="pill">${codigo}</div>
      <div class="pill">${nombre}</div>
    </div>

    <!-- Barras planas + valor debajo -->
    <div class="row-3">
      <div class="price-col">
        <div class="bar">Público</div>
        <div class="val">${pub}</div>
      </div>
      <div class="price-col">
        <div class="bar">Mayoreo</div>
        <div class="val">${may}</div>
      </div>
      <div class="price-col">
        <div class="bar">Distribuidor</div>
        <div class="val">${dis}</div>
      </div>
    </div>

    <div class="kilo">
      <div class="title"><div class="bar">Precio por barra de kilo</div></div>
      <div class="val">${pubK}</div>
      <div class="val">${mayK}</div>
      <div class="val">${disK}</div>
    </div>

    <div class="meta3">
      <div class="col">
        <div class="bar">cats:</div>
        <div class="val">${catsTxt}</div>
      </div>
      <div class="col">
        <div class="bar">categoria:</div>
        <div class="val">${categoria}</div>
      </div>
      <div class="col">
        <div class="bar">contenido:</div>
        <div class="val">${contenido}</div>
      </div>
    </div>
  `;
  el.onclick=()=>openProduct(p);
  return el;
}

function render(filter='all'){
  const DATA=(window.PRODUCTS&&Array.isArray(window.PRODUCTS))?window.PRODUCTS:PRODUCTS;
  grid.innerHTML='';
  DATA.filter(p=>filter==='all'||(p.cats||[]).includes(filter))
      .forEach(p=>grid.appendChild(productCard(p)));
}
btns.forEach(b=>b.onclick=()=>{btns.forEach(x=>x.classList.remove('is-active'));b.classList.add('is-active');currentFilter=b.dataset.filter;render(currentFilter);});
render();

/* ===== Modal (igual) ===== */
const modalProd=document.getElementById('modalProd');
const mpClose=document.getElementById('mp-close');
const mpTitle=document.getElementById('mp-title');
const mpImg=document.getElementById('mp-img');
const mpBenefits=document.getElementById('mp-benefits');
const mpTags=document.getElementById('mp-tags');
const btnOrder=document.getElementById('btn-order');
const mpOverlay=document.getElementById('mp-overlay');

function overlayCard(title,contentHTML){
  return `<div class="overlay-card"><span class="overlay-pill">${title}</span><div>${contentHTML}</div></div>`;
}

function openProduct(p){
  mpTitle.textContent=p.nombre;
  mpImg.src=p.img; mpImg.alt=p.nombre;

  const list=(p.beneficios||[]).map(b=>`<li>${b}</li>`).join('');
  mpBenefits.innerHTML=list?'<ul style="margin:0 0 6px 18px">'+list+'</ul>':'';
  mpTags.textContent=(p.tags&&p.tags.length)?p.tags.join(' · '):'';

  const asArray=v=>Array.isArray(v)?v:(v?[v]:[]);
  const ingredientes=asArray(p.ingredientes).slice(0,5);
  const beneficios=asArray(p.beneficios).slice(0,5);
  const avisos=asArray(p.avisos||p.notaAdvertencia).slice(0,5);

  let html='';
  if(ingredientes.length){html+=overlayCard('Ingredientes',`<ul style="margin:0 0 0 16px;padding:0">${ingredientes.map(x=>`<li>${x}</li>`).join('')}</ul>`);}
  if(beneficios.length){html+=overlayCard('Beneficios',`<ul style="margin:0 0 0 16px;padding:0">${beneficios.map(x=>`<li>${x}</li>`).join('')}</ul>`);}
  if(avisos.length){html+=overlayCard('Avisos',`<ul style="margin:0 0 0 16px;padding:0">${avisos.map(x=>`<li>${x}</li>`).join('')}</ul>`);}

  if(html){mpOverlay.innerHTML=html;mpOverlay.style.display='grid';mpOverlay.setAttribute('aria-hidden','false');}
  else{mpOverlay.innerHTML='';mpOverlay.style.display='none';mpOverlay.setAttribute('aria-hidden','true');}

  modalProd.classList.add('open');
  btnOrder.onclick=onOrder;
}
mpClose.onclick=()=>modalProd.classList.remove('open');

/* ===== Pedido demo ===== */
let isSignedIn=false;
const modalAuth=document.getElementById('modalAuth');
document.getElementById('ma-close').onclick=()=>modalAuth.classList.remove('open');
document.getElementById('login').onclick=()=>{isSignedIn=true;modalAuth.classList.remove('open');goToQuote();};
function onOrder(){ if(!isSignedIn){modalAuth.classList.add('open');} else{goToQuote();} }
function goToQuote(){ window.location.href='../Index.html?open=cotizador'; }

/* ===== Carga JSON ===== */
(function(){
  const hasGrid=document.getElementById('grid'); if(!hasGrid) return;
  const mapCat=s=>{ if(!s) return ''; s=(''+s).toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,''); if(s.includes('sensible'))return'sensible'; if(s.includes('exfol'))return'exfoliante'; if(s.includes('astring'))return'astringente'; if(s.includes('aromatic'))return'aromatico'; return s; };
  const toArray=v=>Array.isArray(v)?v.filter(Boolean):(typeof v==='string'?(v.includes('|||')?v.split('|||').map(x=>x.trim()).filter(Boolean):v.includes(',')?v.split(',').map(x=>x.trim()).filter(Boolean):(v.trim()?[v.trim()]:[])):[]);
  fetch('./catalogo.json',{cache:'no-store'}).then(r=>r.json()).then(data=>{
    const fromJSON=data.map(row=>{
      const cats=toArray(row.cats).map(mapCat).filter(Boolean);
      const beneficios=toArray(row.beneficios);
      const tags=toArray(row.tags);
      const avisos=toArray(row.avisos||row.notaAdvertencia);
      const ingredientes=toArray(row.ingredientes);
      return{
        id:row.id||'',
        nombre:row.nombre||'Producto',
        img:row.img||'../assets/images/placeholder.webp',
        cats,beneficios,avisos,ingredientes,tags,
        forma:row.forma||'',tamano:row.tamano||'',notaAdvertencia:row.notaAdvertencia||'',familia:row.familia||'',
        codigo:row.codigo??'',
        etiqueta:row.etiqueta??'',
        precioPublico:row.precioPublico??'',
        precioMayoreo:row.precioMayoreo??'',
        precioDistribuidor:row.precioDistribuidor??'',
        precioPublico_K:row.precioPublico_K??'',
        precioMayoreo_K:row.precioMayoreo_K??'',
        precioDistribuidor_K:row.precioDistribuidor_K??'',
        categoria:row.categoria ?? row.categirua ?? '',
        categirua:row.categirua ?? '',
        contenido:row.contenido ?? ''
      };
    });
    window.PRODUCTS=fromJSON;
    const active=document.querySelector('.filters button.is-active'); const f=active?active.dataset.filter:'all'; render(f||'all');
  }).catch(err=>console.error('Error cargando catalogo.json',err));
})();
document.getElementById('year').textContent=new Date().getFullYear();
</script>
</body>
</html>
