<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catálogo — Miyotl Products</title>
  <meta name="description" content="Catálogo de jabones artesanales de glicerina. Filtra por piel sensible, exfoliantes, astringentes, aromáticos, shampoo o temporada.">
  <style>
    :root{
      --brand-50:#F7EFE6; --brand-100:#F2E6D8; --brand-200:#EAD6C0; --brand-300:#DBBFA2;
      --brand-400:#C9A781; --brand-500:#2B0F3A; --brand-700:#1B0D28;
      --miyotl:#C53D8C; --ink:#140A1F;
      --rose:#E067C6; --rose-strong:#A83477; --muted:#8E8E8E;
      --bar:#F2CFE9;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,Segoe UI,Roboto,Arial;color:var(--ink);background:#fff;font-size:13px;line-height:1.35}
    .container{max-width:1120px;margin:0 auto;padding:0 16px}

    header{background:#e1d1bd}
    .top-banner{width:100%;height:260px;object-fit:cover;display:block;filter:saturate(0.9)}
    .headline{position:relative}

    .filters-wrap{display:flex;justify-content:center;align-items:center;flex-wrap:wrap;gap:12px;padding:12px 16px;border-bottom:1px solid var(--brand-200);background:#fff}
    .filters button{appearance:none;border:1px solid #A83477;background:var(--miyotl);color:#fff;cursor:pointer;padding:6px 10px;border-radius:12px;font-weight:700;font-size:12px;transition:.15s transform,.15s opacity}
    .filters button:hover{transform:translateY(-1px)}
    .filters button.is-active{box-shadow:0 2px 10px rgba(0,0,0,.12)}
    .note{font-size:11px;color:#4d4d4d;text-align:center;margin:8px 0 18px}

    .grid{display:grid;gap:18px}
    @media(min-width:768px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}

    .card{background:#fff;border:2px solid var(--rose);border-radius:22px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,.06);transition:.15s transform,.15s border-color;cursor:pointer}
    .card:hover{transform:translateY(-3px);border-color:var(--rose-strong)}
    .card .image-wrap{position:relative;border-radius:20px;overflow:hidden;margin:6px;border:2px solid var(--rose)}
    .card .image-wrap img{width:100%;aspect-ratio:1/1;object-fit:cover;display:block;filter:saturate(.98)}
    .card .badge{position:absolute;right:10px;bottom:10px;width:60px;height:60px;border-radius:999px;background:var(--rose);color:#fff;display:flex;align-items:center;justify-content:center;text-align:center;font-weight:800;line-height:1.05;padding:6px;box-shadow:0 6px 18px rgba(0,0,0,.18);font-size:10px}

    .card .row-2{display:grid;grid-template-columns:1fr 2fr;gap:10px;padding:8px 10px 0}
    .pill{background:#fff;border:2px solid var(--rose);border-radius:16px;padding:6px 9px;color:#5A5A5A;font-weight:800;text-align:center;min-height:30px;display:flex;align-items:center;justify-content:center;font-size:11px}

    .bar{background:var(--bar);color:#2b2330;border-radius:4px;text-align:center;font-weight:800;padding:4px 0;font-size:10px;line-height:1.1}
    .val{font-weight:800;text-align:center;color:#4b4b4b;font-size:11px;margin-top:4px}
    .row-3{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;padding:8px 10px 2px}
    .price-col{display:grid}
    .kilo{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;padding:8px 10px 0}
    .kilo .title{grid-column:1/-1}
    .empty{margin:26px auto;max-width:860px;padding:12px 14px;border:1px dashed #d3a7c7;border-radius:12px;color:#6b3e64;background:#fff9fd;text-align:center;font-weight:700}

    /* ================= MODAL (ARREGLADO) ================= */
    .modal{
      position:fixed; inset:0;
      display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,.55);
      padding:24px; z-index:1000;
      overflow:auto;                 /* si todo crece, la página scrollea */
    }
    .modal.open{display:flex}

    /* Imagen | Columna info */
    #modalProd .sheet{
      position:relative;
      display:grid;
      grid-template-columns:minmax(0, 1fr) 340px; /* imagen flexible + panel fijo */
      gap:16px;
      align-items:start;
      max-width:min(1200px,95vw);
      width:100%;
    }
    /* Ajuste de alineación vertical del panel derecho */
#modalProd .sheet > .mp-overlay{
  align-self: start;
  margin-top: -8px; /* súbelo un poco */
}


    /* Contenedor de imagen: respeta bordes, centra y limita altura */
    #modalProd .img-max{
      position:relative;
      width:100%;
      border-radius:18px;
      overflow:hidden;
      box-shadow:0 12px 40px rgba(0,0,0,.45);
      border:2px solid var(--rose);
      background:#fff;
      display:flex; align-items:center; justify-content:center;
      min-height:200px;
    }
    #modalProd .img-max img{
      display:block;
      max-width:100%;
      max-height:82vh;       /* <— clave para que no se salga */
      width:auto; height:auto;
      border-radius:18px;
      object-fit:contain;
    }

    /* Botón cerrar, anclado al contenedor del modal */
    #mp-close{
      position:absolute;
      top:-14px; right:-14px;
      z-index:3;
      background:#fff; color:var(--ink);
      border:2px solid var(--rose); border-radius:999px;
      padding:8px 12px; font-weight:900; cursor:pointer;
      box-shadow:0 6px 16px rgba(0,0,0,.25)
    }

    /* Columna de detalles: hace scroll propio, no se corta */
    .mp-overlay{
      position:relative;
      display:flex; flex-direction:column; gap:12px;
      width:100%;
      max-height:82vh;        /* igual que la imagen */
      overflow:auto;          /* scroll propio */
      padding-right:2px;      /* deja ver barra de scroll */
      padding-top:16px;       /* <<< evita que la pill se corte */
    }
    .overlay-card{
      position:relative; background:#fff; border:2px solid var(--rose);
      border-radius:12px; padding:8px 10px 10px;
      box-shadow:0 6px 18px rgba(0,0,0,.25);
      max-height:none; overflow:visible; font-size:12px; color:#4b4b4b
    }
    .overlay-pill{
      position:absolute; left:8px; top:-12px; background:#D874C3;
      color:#fff; border:none; border-radius:14px; padding:4px 10px;
      font-weight:800; font-size:11px
    }

    /* En pantallas chicas: todo en columna (imagen arriba) */
    @media (max-width: 900px){
      #modalProd .sheet{grid-template-columns:1fr}
      .mp-overlay{max-height:none; overflow:visible; margin:4px 0 0}
      #mp-close{top:-12px; right:-12px}
      #modalProd .sheet > .mp-overlay{ margin-top: 0; }

    }
    

    footer{padding:18px 0 28px;border-top:1px solid var(--brand-100);margin-top:28px}
  </style>
</head>
<body>

<header class="headline">
  <img class="top-banner" src="assets/images/catalogo-banner.webp" alt="">
</header>

<div class="filters-wrap">
  <div class="filters">
  <button onclick="location.href='index.html'" style="background:#fff;color:var(--miyotl);border:2px solid var(--miyotl);font-weight:800;">Inicio</button>

  <button data-filter="all" class="is-active">Todos</button>
  <button data-filter="Jabón sólido">Jabón sólido</button>  
  <button data-filter="Jabón líquido">Jabón líquido</button>
  <button data-filter="Jabón corporal">Jabón corporal</button>
  <button data-filter="Shampoo">Shampoo</button>
  <button data-filter="Decorativos">Decorativos</button>
  <button data-filter="Temporada">Temporada</button>
</div>
</div>
<p class="note">Haz clic en cualquier producto para ver sus beneficios.</p>

<main class="container">
  <section id="grid" class="grid"></section>
  <div id="empty" class="empty" style="display:none"></div>
</main>

<footer><div class="container" style="text-align:center">© <span id="year"></span> Miyotl Products · Hecho en México</div></footer>

<!-- Modal -->
<div id="modalProd" class="modal" role="dialog" aria-modal="true">
  <div class="sheet">
    <button id="mp-close" class="btn secondary">Cerrar</button>
    <div class="img-max">
      <img id="mp-img" alt="">
    </div>
    <div id="mp-overlay" class="mp-overlay" aria-hidden="true" style="display:none"></div>
  </div>
</div>

<script>
const grid=document.getElementById('grid');
const empty=document.getElementById('empty');
const btns=document.querySelectorAll('.filters button[data-filter]');
let PRODUCTS=[];

const money=v=>{if(v===undefined||v===null||v==='')return'';const n=Number(v);return Number.isFinite(n)?n.toLocaleString('es-MX',{style:'currency',currency:'MXN',maximumFractionDigits:0}):(v+'');};

/* === Helpers de imagen con fallback por categoría === */
const norm = s => (s||'').toString().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
function fallbackByCategory(cat){
  const c = norm(cat);
  if (c.includes('solido') || c.includes('sólido')) return 'assets/images/102000.webp'; // barra
  if (c.includes('shampoo') || c.includes('corporal') || c.includes('liquido') || c.includes('líquido'))
    return 'assets/images/104000.webp'; // botella
  return 'assets/images/102000.webp';
}
function handleImgError(img){
  const base = img.dataset.base || '';
  const step = img.dataset.step || 'webp';
  if (step === 'webp'){ img.dataset.step='jpg'; img.src = base + '.jpg'; return; }
  if (step === 'jpg'){ img.dataset.step='png'; img.src = base + '.png'; return; }
  if (img.dataset.fallback){ img.onerror=null; img.src = img.dataset.fallback; return; }
  img.onerror = null;
}

/* ---------- Tarjeta ---------- */
function productCard(p){
  const el=document.createElement('article'); el.className='card'; el.dataset.cats=(p.cats||[]).join(',');

  const pub=money(p.precioPublico), may=money(p.precioMayoreo), dis=money(p.precioDistribuidor);
  const pubK=money(p.precioPublico_K), mayK=money(p.precioMayoreo_K), disK=money(p.precioDistribuidor_K);

  const fb = fallbackByCategory(p.categoria);

  el.innerHTML=`
    <div class="image-wrap">
      <img src="${p.img}" alt="${p.nombre||''}" loading="lazy"
           data-base="${p.imgBase}"
           data-step="webp"
           data-fallback="${fb}"
           onerror="handleImgError(this)">
      ${p.etiqueta?`<div class="badge">${p.etiqueta}</div>`:''}
    </div>

    <div class="row-2">
      <div class="pill">${p.codigo||p.id||''}</div>
      <div class="pill">${p.nombre||''}</div>
    </div>

    <div class="row-3">
      <div class="price-col"><div class="bar">Público</div><div class="val">${pub}</div></div>
      <div class="price-col"><div class="bar">Mayoreo</div><div class="val">${may}</div></div>
      <div class="price-col"><div class="bar">Distribuidor</div><div class="val">${dis}</div></div>
    </div>

    <div class="kilo">
      <div class="title"><div class="bar">Por barra de kilo</div></div>
      <div class="val">${pubK}</div><div class="val">${mayK}</div><div class="val">${disK}</div>
    </div>
        <!-- Meta extra desde el JSON -->
    <div class="row-3">
      <div class="price-col"><div class="bar">cats</div>
        <div class="val">${(p.cats||[]).join(', ')}</div>
      </div>
      <div class="price-col"><div class="bar">categoría</div>
        <div class="val">${p.categoria||''}</div>
      </div>
      <div class="price-col"><div class="bar">contenido</div>
        <div class="val">${p.contenido||''}</div>
      </div>
    </div>

  `;
  el.onclick=()=>openProduct(p);
  return el;
}

function render(filter='all'){
  grid.innerHTML='';
  const list=PRODUCTS.filter(p=>{
    return filter==='all' ? true : (p.categoria === filter);
  });
  list.forEach(p=>grid.appendChild(productCard(p)));
  empty.style.display=list.length?'none':'block';
  if(!list.length){
    empty.innerHTML='No hay productos para mostrar. Revisa que <b>catalogo.json</b> exista, tenga formato válido y esté en la misma carpeta que <b>catalogo.html</b>.';
  }
}
btns.forEach(b=>b.onclick=()=>{btns.forEach(x=>x.classList.remove('is-active'));b.classList.add('is-active');render(b.dataset.filter);});

/* ---------- Modal ---------- */
const modalProd=document.getElementById('modalProd'),
      mpClose=document.getElementById('mp-close'),
      mpImg=document.getElementById('mp-img'),
      mpOverlay=document.getElementById('mp-overlay');

const overlayCard=(t,h)=>`<div class="overlay-card"><span class="overlay-pill">${t}</span><div>${h}</div></div>`;
function openProduct(p){
  const arr=v=>Array.isArray(v)?v:(v?[v]:[]);
  const fb = fallbackByCategory(p.categoria);

  mpImg.dataset.base = p.imgBase;
  mpImg.dataset.step = 'webp';
  mpImg.dataset.fallback = fb;
  mpImg.onerror = () => handleImgError(mpImg);
  mpImg.src = p.img;
  mpImg.alt = p.nombre||'';

  let html='';
  if(arr(p.ingredientes).length) html+=overlayCard('Ingredientes',`<ul style="margin:0 0 0 16px">${arr(p.ingredientes).slice(0,5).map(x=>`<li>${x}</li>`).join('')}</ul>`);
  if(arr(p.beneficios).length)   html+=overlayCard('Beneficios',  `<ul style="margin:0 0 0 16px">${arr(p.beneficios).slice(0,5).map(x=>`<li>${x}</li>`).join('')}</ul>`);
  if(arr(p.avisos).length)       html+=overlayCard('Avisos',      `<ul style="margin:0 0 0 16px">${arr(p.avisos).slice(0,5).map(x=>`<li>${x}</li>`).join('')}</ul>`);
  mpOverlay.innerHTML=html; mpOverlay.style.display=html?'flex':'none';

  modalProd.classList.add('open');
}
mpClose.onclick=()=>modalProd.classList.remove('open');

/* ---------- Carga JSON por ID ---------- */
(function(){
  const mapCat=s=>{if(!s)return'';s=(''+s).toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');if(s.includes('sensible'))return'sensible';if(s.includes('exfol'))return'exfoliante';if(s.includes('astring'))return'astringente';if(s.includes('aromatic'))return'aromatico';return s;};
  const toArray=v=>Array.isArray(v)?v.filter(Boolean):(typeof v==='string'?(v.includes('|||')?v.split('|||').map(x=>x.trim()).filter(Boolean):v.includes(',')?v.split(',').map(x=>x.trim()).filter(Boolean):(v.trim()?[v.trim()]:[])):[]);
  const toSlug=s=>(s||'').toString().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'_').replace(/^_|_$/g,'');

  const getId = row => {
    const raw = (row.id ?? row.codigo ?? '').toString().trim();
    return raw || toSlug(row.nombre||'');
  };
  const imgBaseById = row => {
    const id = getId(row);
    if (!id) return 'assets/images/placeholder';
    if (/^https?:\/\//i.test(row.img||'')) return row.img;
    return `assets/images/${id}`;
  };

  async function loadJSON(){
    const tries=['./catalogo.json','catalogo.json','/Miyotl/catalogo.json','./Catalogo.json'];
    for(const url of tries){
      try{
        const r=await fetch(url+'?v='+Date.now(),{cache:'no-store'});
        if(!r.ok) continue;
        return await r.json();
      }catch(e){}
    }
    throw new Error('No se pudo cargar catalogo.json desde ninguna ruta conocida.');
  }

  loadJSON().then(data=>{
    PRODUCTS = data.map(row=>{
      const cats=toArray(row.cats).map(mapCat).filter(Boolean);
      const base=imgBaseById(row);
      return {
        id: getId(row),
        codigo: row.codigo ?? '',
        nombre: row.nombre || 'Producto',
        imgBase: /^https?:\/\//i.test(base) ? base.replace(/\.(webp|png|jpg|jpeg)$/i,'') : base,
        img: /^https?:\/\//i.test(base) ? base : `${base}.webp`,
        cats,
        beneficios: toArray(row.beneficios),
        avisos: toArray(row.avisos || row.notaAdvertencia),
        ingredientes: toArray(row.ingredientes),
        etiqueta: row.etiqueta ?? '',
        precioPublico: row.precioPublico ?? '',
        precioMayoreo: row.precioMayoreo ?? '',
        precioDistribuidor: row.precioDistribuidor ?? '',
        precioPublico_K: row.precioPublico_K ?? '',
        precioMayoreo_K: row.precioMayoreo_K ?? '',
        precioDistribuidor_K: row.precioDistribuidor_K ?? '',
        categoria: row.categoria ?? row.categirua ?? '',
        contenido: row.contenido ?? ''
      };
    });
    render('all');
  }).catch(err=>{
    console.error(err);
    empty.style.display='block';
    empty.innerHTML='⚠️ No se pudo cargar <b>catalogo.json</b>. Verifica que el archivo exista en la misma carpeta y que el nombre coincida exactamente.';
  });
})();
document.getElementById('year').textContent=new Date().getFullYear();
</script>
</body>
</html>





